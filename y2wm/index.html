<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta name="referrer" content="no-referrer">
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <meta content="width=device-width,initial-scale=1,user-scalable=no" name="viewport"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-touch-fullscreen" content="yes"/>
  <meta name="format-detection" content="telephone=no,address=no"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="white"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title></title>
  <link rel="icon" href="data:;base64,=">
  <link rel="stylesheet" href="./css/index.css"/>
  <link rel="stylesheet" type="text/css" href="./css/h5.css"/>
  <script src="https://cdn.staticfile.org/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://cdn.staticfile.org/Base64/1.3.0/base64.min.js"></script>
  <link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css">
  <script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="../js/common.js"></script>
  <style>
      .alertContainer {
          position: fixed;
          bottom: 0;
          left: 0;
          background-color: #ffe58f;
          width: 100%;
          text-align: center;
          color: #ffffff;
          font-weight: 700;
          padding: 10px;
          display: none;
      }

      .loading {
          width: 50px;
          height: 50px;
          border-radius: 100%;
          background-color: #007ADD;
          position: fixed;
          left: calc(50% - 25px);
          top: calc(50% - 25px);
          animation: ball-scale infinite linear 0.75s;
      }

      @keyframes ball-scale {
          0% {
              transform: scale(0.1);
              opacity: 1;
          }

          100% {
              transform: scale(1);
              opacity: 0;
          }
      }
  </style>
</head>

<body>
<div id="app">
  <!-- 页面加载Loading -->
  <div id="Loading" class="loading"></div>
  <!-- 主页面 -->
  <div id="Main" style="display: none">
    <div class="main-contant" id="MainContent">
      <!-- 图片 -->
      <div class="img-container">
        <!-- 水印图片 -->
        <img id="top-icon" src="./images/topIcon.png" alt="">
        <!-- 产品图片 -->
        <img id="cover" src="" alt="">
      </div>
      <!-- 产品信息 -->
      <div class="productcard">
        <div class="product-title">
          基本信息
        </div>
        <!-- 根据页面数据数量调整产品信息显示模式 -->
        <!-- 显示模式1 -->
        <div class="product-content" id="product-wrap" style="display: none">
          <div class="cardinfotitle">
            <div class="cardinfotitle-title">品规：</div>
            <div class="cardinfotitle-info" id="brandName"></div>
          </div>
          <div class="cardinfotitle">
            <div class="cardinfotitle-title">品规所属企业：</div>
            <div class="cardinfotitle-info" id="corpName"></div>
          </div>

          <!-- 卷烟数据显示 -->
          <div id="product-wrap-cigarette">
            <div class="cardinfotitle">
              <div class="cardinfotitle-float" style="width: 55%;">
                <div class="cardinfotitle-title">烟气一氧化碳：</div>
                <div class="cardinfotitle-info" id="carbonicOxide"></div>
              </div>
              <div class="cardinfotitle-float" style="width: 45%;">
                <div class="cardinfotitle-title">类&nbsp;&nbsp;&nbsp;型：</div>
                <div class="cardinfotitle-info" id="typeName"></div>
              </div>
            </div>
            <div class="cardinfotitle">
              <div class="cardinfotitle-float" style="width: 55%;">
                <div class="cardinfotitle-title">烟气烟碱量：</div>
                <div class="cardinfotitle-info" id="alkaliName"></div>
              </div>
              <div class="cardinfotitle-float" style="width: 45%;">
                <div class="cardinfotitle-title">焦油量：</div>
                <div class="cardinfotitle-info" id="tarName"></div>
              </div>
            </div>
          </div>
          <!-- 雪茄烟数据显示 -->
          <div id="product-wrap-cigar" style="display: none">
            <div class="cardinfotitle">
              <div class="cardinfotitle-float" style="width: 50%;">
                <div class="cardinfotitle-title">焦油量：</div>
                <div class="cardinfotitle-info" id="cigarTarName"></div>
              </div>
              <div class="cardinfotitle-float" style="width: 50%;">
                <div class="cardinfotitle-title">环径：</div>
                <div class="cardinfotitle-info" id="cigarRingDiameterName"></div>
              </div>
            </div>
            <div class="cardinfotitle">
              <div class="cardinfotitle-float" style="width: 50%;">
                <div class="cardinfotitle-title">烟支长度：</div>
                <div class="cardinfotitle-info" id="cigarLengthName"></div>
              </div>
              <div class="cardinfotitle-float" style="width: 50%;">
                <div class="cardinfotitle-title">烟支周长：</div>
                <div class="cardinfotitle-info" id="cigarPerimeterName"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- 显示模式2 -->
        <div class="product-content-spacing" id="product-wrap-spacing" style="display: none">
          <div class="cardinfotitle">
            <div class="cardinfotitle-title">品规：</div>
            <div class="cardinfotitle-info" id="brandName-spacing"></div>
          </div>
          <div class="cardinfotitle">
            <div class="cardinfotitle-title">品规所属企业：</div>
            <div class="cardinfotitle-info" id="corpName-spacing"></div>
          </div>

          <!-- 卷烟数据显示 -->
          <div id="product-wrap-spacing-cigarette" style="display: none">
            <div class="cardinfotitle">
              <div class="cardinfotitle-float" style="width: 55%;">
                <div class="cardinfotitle-title">烟气一氧化碳：</div>
                <div class="cardinfotitle-info" id="carbonicOxide-spacing"></div>
              </div>
              <div class="cardinfotitle-float" style="width: 45%;">
                <div class="cardinfotitle-title">类&nbsp;&nbsp;&nbsp;型：</div>
                <div class="cardinfotitle-info" id="typeName-spacing"></div>
              </div>
            </div>
            <div class="cardinfotitle">
              <div class="cardinfotitle-float" style="width: 55%;">
                <div class="cardinfotitle-title">烟气烟碱量：</div>
                <div class="cardinfotitle-info" id="alkaliName-spacing"></div>
              </div>
              <div class="cardinfotitle-float" style="width: 45%;">
                <div class="cardinfotitle-title">焦油量：</div>
                <div class="cardinfotitle-info" id="tarName-spacing"></div>
              </div>
            </div>
          </div>

          <!-- 雪茄烟数据显示 -->
          <div id="product-wrap-spacing-cigar" style="display: none">
            <div class="cardinfotitle">
              <div class="cardinfotitle-float" style="width: 50%;">
                <div class="cardinfotitle-title">焦油量：</div>
                <div class="cardinfotitle-info" id="cigarTarName-spacing"></div>
              </div>
              <div class="cardinfotitle-float" style="width: 50%;">
                <div class="cardinfotitle-title">环径：</div>
                <div class="cardinfotitle-info" id="cigarRingDiameterName-spacing"></div>
              </div>
            </div>
            <div class="cardinfotitle">
              <div class="cardinfotitle-float" style="width: 50%;">
                <div class="cardinfotitle-title">烟支长度：</div>
                <div class="cardinfotitle-info" id="cigarLengthName-spacing"></div>
              </div>
              <div class="cardinfotitle-float" style="width: 50%;">
                <div class="cardinfotitle-title">烟支周长：</div>
                <div class="cardinfotitle-info" id="cigarPerimeterName-spacing"></div>
              </div>
            </div>
          </div>

        </div>
      </div>
      <!-- 全国市场监管服务热线 -->
      <div class="productcard">
        <div class="product-title">
          全国市场监管服务热线
        </div>
        <div class="normal-content">
          <div class="normal-info">
            <a href="tel:12313" style="color: #0C7EEA;">12313</a>
          </div>
        </div>
      </div>
      <div id="custom-wrap" class="productcard" style="display: none">
        <div id="custom-title" class="product-title">
          企业服务热线
        </div>
        <div class="normal-content">
          <div class="normal-info">
            <a id="custom-content" href="#" style="color: #0C7EEA;">暂无数据</a>
          </div>
        </div>
      </div>
    </div>
    <div class="footer" id="enterprise-services" style="display: none">
      <div class="button" style="display: none">
        自助购买
      </div>
      <div class="button" onclick="jumpToOther()">
        企业服务
      </div>
    </div>
  </div>
  <div id="Err" class="errorContainer" style="display: none">
    <div class="content">
      <img id="errImage" src="" alt="">
      <div id="errorMessage" class="scan-error-msg">二维码不存在</div>
    </div>
    <div class="footer">
      <div class="close" onclick="handleOnClose()">
        关&nbsp;&nbsp;&nbsp;&nbsp;闭
      </div>
    </div>
  </div>
  <div id="alert" class="alertContainer">
    企业服务未开通
  </div>
</div>
</body>
<script>
  NProgress.configure({showSpinner: false});
  let queryParams = {}
  let res = {}
  $(function () {
    queryParams = JSON.parse(decodeBase64(parseUrlSearchParams().p))
    setTimeout(function () {
      $.getJSON(`./json/${queryParams.name}.json`, data => {
        res = data
        init()
      })
    }, 1500)
  })

  function init() {
    // 全局打开且企业打开: 显示详情页
    $('#Main').show();
    $('#Err').hide();
    // 是否配置企业服务热线
    if (res.customTitle && res.customContent) {
      // 企业服务热线
      // 获取要更改的链接元素
      var customContentLink = document.getElementById("custom-content");
      // 定义要设置的新的href值
      var newCustomContentLink = "tel:" + (res.customContent || '');
      // 动态设置href属性
      customContentLink.setAttribute("href", newCustomContentLink);
      $("#custom-wrap").show();
    }
    // 配置了路由展示企业服务
    if (res.routeConfig && JSON.stringify(res.routeConfig) !== "{}") {
      $("#enterprise-services").show();
      document.getElementById('MainContent').style.bottom = '80px';
    } else {
      document.getElementById('MainContent').style.bottom = 0;
    }
    // 数据显示项目是否完全
    if ((res.routeConfig && JSON.stringify(res.routeConfig) !== "{}") && (res.customTitle && res.customContent)) {
      $("#product-wrap").show();
      // 区分卷烟和雪茄烟
      if (res.codeData.meta.spuType === 'AC') {
        $("#product-wrap-cigarette").show();
      } else {
        $("#product-wrap-cigar").show();
      }
    } else {
      $("#product-wrap-spacing").show();
      // 区分卷烟和雪茄烟
      if (res.codeData.meta.spuType === 'AC') {
        $("#product-wrap-spacing-cigarette").show();
      } else {
        $("#product-wrap-spacing-cigar").show();
      }
    }
    setDom();
    $('#Loading').hide()
  }

  function setDom() {
    const qrcodeResult = res;
    let meta = {}
    let isBox = false

    if (res && res.codeData) {
      if (res.codeData.meta !== null && res.codeData.meta !== undefined) {
        meta = res.codeData.meta;
      }
      isBox = res.codeData.packaging === '0'
    }

    if (meta && meta.品牌 && meta.规格) {
      $("#brandName").html(meta.规格)
    }

    if (meta) {
      if (meta.ownerName !== null && meta.ownerName !== undefined) {
        $("#corpName").html(meta.ownerName)
      } else {
        $("#corpName").html(meta.企业名称)
      }
      $("#carbonicOxide").html(setValue(meta.烟气一氧化碳量, ' mg'))
      $("#typeName").html(meta.卷烟类型代码)
      $("#alkaliName").html(setValue(meta.卷烟烟气烟碱量, ' mg'))
      $("#tarName").html(setValue(meta.卷烟焦油量, ' mg'))

      $("#cigarTarName").html(meta.卷烟焦油量) //焦油量
      $("#cigarRingDiameterName").html(meta.ringDiameter) //环径
      $("#cigarLengthName").html(setValue(meta.length, ' mm')) //烟支长度
      $("#cigarPerimeterName").html(setValue(meta.perimeter, ' mm'))  //烟支周长

      $("#brandName-spacing").html(meta.规格)
      if (meta.ownerName !== null && meta.ownerName !== undefined) {
        $("#corpName-spacing").html(meta.ownerName)
      } else {
        $("#corpName-spacing").html(meta.企业名称)
      }
      $("#carbonicOxide-spacing").html(setValue(meta.烟气一氧化碳量, ' mg'))
      $("#typeName-spacing").html(meta.卷烟类型代码)
      $("#alkaliName-spacing").html(setValue(meta.卷烟烟气烟碱量, ' mg'))
      $("#tarName-spacing").html(setValue(meta.卷烟焦油量, ' mg'))

      $("#cigarTarName-spacing").html(meta.卷烟焦油量) //焦油量
      $("#cigarRingDiameterName-spacing").html(meta.ringDiameter) //环径
      $("#cigarLengthName-spacing").html(setValue(meta.length, ' mm')) //烟支长度
      $("#cigarPerimeterName-spacing").html(setValue(meta.perimeter, ' mm'))  //烟支周长
    } else {
      $("#corpName").html('')
      $("#carbonicOxide").html(setValue('', ' mg'))
      $("#typeName").html('')
      $("#alkaliName").html(setValue('', ' mg'))
      $("#tarName").html(setValue('', ' mg'))
      $("#brandName-spacing").html('')
      $("#corpName-spacing").html('')
      $("#carbonicOxide-spacing").html(setValue('', ' mg'))
      $("#typeName-spacing").html('')
      $("#alkaliName-spacing").html(setValue('', ' mg'))
      $("#tarName-spacing").html(setValue('', ' mg'))

      $("#cigarTarName").html('') //焦油量
      $("#cigarRingDiameterName").html('') //环径
      $("#cigarLengthName").html(setValue('', ' mm')) //烟支长度
      $("#cigarPerimeterName").html(setValue('', ' mm'))  //烟支周长

      $("#cigarTarName-spacing").html('') //焦油量
      $("#cigarRingDiameterName-spacing").html('') //环径
      $("#cigarLengthName-spacing").html(setValue('', ' mm')) //烟支长度
      $("#cigarPerimeterName-spacing").html(setValue('', ' mm'))  //烟支周长
    }
    $("#custom-title").html('企业服务热线')
    if (res) {
      if (res.customContent !== null && res.customContent !== undefined) {
        $("#custom-content").html(res.customContent)
      } else {
        $("#custom-content").html('')
      }
      if (res.imageUrl !== null && res.imageUrl !== undefined) {
        $("#cover").attr('src', res.imageUrl)
      } else {
        $("#cover").attr('src', './images/topImg.png')
      }
    } else {
      $("#custom-content").html('')
      $("#cover").attr('src', './images/topImg.png')
    }
    $('#top-icon').show();
  }

  function checkBrowser() {
    const ua = navigator.userAgent.toLowerCase();
    if (ua.match(/MicroMessenger/i) == 'micromessenger') { // 微信
      return 1
    } else if (ua.match(/Alipay/i) == "alipay") {   // 支付宝
      return 2
    } else { // 浏览器
      return 0
    }
  }

  function setValue(val, unit) {
    if (val) {
      return val + unit
    } else {
      return ''
    }
  }

  function jumpToOther() {
    const scanType = checkBrowser()
    let config = null
    if (res && res.routeConfig && res.routeConfig[scanType]) {
      config = res.routeConfig[scanType]
    }
    if (!config) {
      // Alert('企业服务未开通')
      return;
    }
    NProgress.start()
    if (config.linkUrl) {
      setTimeout(function () {
        let linkUrl = config.linkUrl
        if (linkUrl.indexOf('?') > 0) {
          linkUrl += '&captcha=' + queryParams.captcha
        } else {
          linkUrl += '?captcha=' + queryParams.captcha
        }
        window.location.replace(linkUrl)
      }, 1000)

    }
  }

  function handleOnClose() {
    if (checkBrowser() === 0) {
      if (navigator.userAgent.indexOf("Firefox") !== -1 || navigator.userAgent.indexOf("Chrome") !== -1) {
        window.location.href = "about:blank";
        window.close();
      } else {
        window.opener = null;
        window.open("", "_self");
        window.close();
      }
    } else if (checkBrowser() === 1) {
      //针对苹果不能关闭当前页面
      if (userAgent.indexOf('Android') > -1 || userAgent.indexOf('Linux') > -1) {
        WeixinJSBridge.call('closeWindow');
      } else {
        //针对苹果不能关闭当前页面
        setTimeout(function () {
          WeixinJSBridge.invoke("closeWindow", {}, function (e) {
          })
        }, 100)
      }
    } else if (checkBrowser() === 2) {
      if (userAgent.indexOf('Android') > -1 || userAgent.indexOf('Linux') > -1) {
        AlipayJSBridge.call('closeWindow');
      } else {
        //针对苹果不能关闭当前页面
        setTimeout(function () {
          AlipayJSBridge.invoke("closeWindow", {}, function (e) {
          })
        }, 100)
      }
    }
  }
</script>
</html>
